#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# fail fast
set -e

# debug
# set -x

# clean up leaking environment
unset GIT_DIR

if [ ! -d $BUILD_DIR/.python-ldap/groff ]; then
  echo "-----> Installing Groff"
  curl -O ftp://ftp.gnu.org/gnu/groff/groff-1.21.tar.gz
  tar -zxvf groff-1.21.tar.gz
  cd groff-1.21
  ./configure --prefix=$BUILD_DIR/.python-ldap/groff
  make PROCESSEDEXAMPLEFILES=""
  make PROCESSEDEXAMPLEFILES="" install
  cd $BUILD_DIR
  cp -R .python-ldap/groff $CACHE_DIR/.python-ldap
fi

echo "-----> Adding soelim to path"
export PATH=$PATH:$BUILD_DIR/.python-ldap/groff/bin

pip install awscli
